<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>G·ª≠i Anh ‚Äî Ph√∫ anh c·ª•a em</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg1: #ffafbd;
      --bg2: #ffc3a0;
      --accent: #ff4d6d;
      --card: rgba(255,255,255,0.9);
      --glass: rgba(255,255,255,0.12);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    body{
      background: linear-gradient(135deg,var(--bg1),var(--bg2));
      display:flex;align-items:center;justify-content:center;padding:24px;
      overflow:hidden;
    }

    /* floating heart background */
    .hearts {position:fixed;inset:0;pointer-events:none;overflow:hidden}
    .heart{
      position:absolute;bottom:-10vh;width:24px;height:24px;transform:rotate(-45deg);
      animation: rise linear infinite;opacity:0.9;
    }
    .heart::before,.heart::after{content:'';position:absolute;width:24px;height:24px;border-radius:50%;background:var(--accent)}
    .heart::before{top:-12px;left:0}
    .heart::after{left:12px;top:0}
    @keyframes rise{
      0%{transform:translateY(0) rotate(-45deg) scale(0.6);opacity:0}
      10%{opacity:1}
      100%{transform:translateY(-140vh) rotate(45deg) scale(1.2);opacity:0}
    }

    /* main card */
    .card{
      width:100%;max-width:820px;background:var(--card);border-radius:18px;padding:28px;box-shadow:0 10px 40px rgba(0,0,0,0.12);
      backdrop-filter: blur(6px);position:relative;overflow:hidden;
    }

    .header{display:flex;gap:16px;align-items:center}
    .logo{font-family:'Great Vibes',cursive;font-size:40px;color:var(--accent);line-height:1}
    .subtitle{color:#333;opacity:0.85}

    .content{display:flex;flex-direction:column;gap:20px;margin-top:16px}

    .preview{
      background:linear-gradient(180deg, rgba(255,255,255,0.7), rgba(255,255,255,0.6));
      border-radius:12px;padding:28px;min-height:160px;display:flex;align-items:center;justify-content:center;text-align:center;
      font-size:22px;color:#7b3a46;font-weight:600;position:relative;
    }

    .message{font-size:22px}
    .from{position:absolute;right:14px;bottom:10px;font-size:13px;color:#7b3a46;opacity:0.9}

    .controls{display:flex;gap:12px;flex-wrap:wrap}
    .btn{
      background:var(--accent);color:white;border:none;padding:12px 18px;border-radius:12px;cursor:pointer;font-weight:700;box-shadow:0 6px 18px rgba(0,0,0,0.12);
      transition:transform .12s ease, box-shadow .12s ease;display:inline-flex;align-items:center;gap:8px
    }
    .btn:active{transform:translateY(2px)}
    .btn.secondary{background:transparent;color:var(--accent);border:2px solid rgba(255,77,109,0.12)}

    .heart-btn{display:inline-block;width:20px;height:20px;transform:scale(1.05);}

    /* pulse behind button */
    .pulse{position:absolute;inset:auto 0 -40px 0;height:30px;display:flex;justify-content:center}
    .pulse .dot{width:120px;height:120px;border-radius:50%;background:radial-gradient(circle at center, rgba(255,77,109,0.14), transparent);animation:pulse 2s infinite}
    @keyframes pulse{0%{transform:scale(.9)}50%{transform:scale(1.06)}100%{transform:scale(.9)}}

    /* small footer */
    .meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px;color:#7b3a46;opacity:0.9}

    /* confetti canvas sits on top */
    canvas.confetti{position:absolute;inset:0;pointer-events:none}

    /* responsive */
    @media (max-width:640px){.logo{font-size:34px}.preview{font-size:18px;padding:20px}}
  </style>
</head>
<body>
  <div class="hearts" id="hearts"></div>

  <div class="card" role="main">
    <canvas class="confetti" id="conf"></canvas>
    <div class="header">
      <div class="logo">G·ª≠i Anh</div>
      <div class="subtitle">ƒê√¢y l√† m√≥n qu√† nh·ªè c·ªßa em, hy v·ªçng n√≥ s·∫Ω ti·∫øp th√™m s·ª©c m·∫°nh m·ªói khi anh m·ªát </div>
    </div>

    <div class="content">
      <div class="preview" id="preview">
        <div class="message" id="message">Nh·∫•n n√∫t "Nh·∫≠n l·ªùi ch√∫c" ƒë·ªÉ nh·∫≠n m·ªôt c√¢u ch√∫c b·∫•t ng·ªù nh√©, em y√™u üíå</div>
        <div class="from" id="from">‚Äî Ng∆∞·ªùi t·∫∑ng</div>
      </div>

      <div class="controls">
        <button class="btn" id="btnRandom">
          <svg class="heart-btn" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 21s-7-4.58-9.06-7.04C1.64 11.9 3.1 7 7 6.04c2-.6 4.02.56 5 2.04 0 0 1.21-2.64 4-2.04 3.9.96 5.36 5.86 4.06 7.92C19 16.42 12 21 12 21z" fill="white"/></svg>
          Nh·∫≠n l·ªùi ch√∫c
        </button>

        <button class="btn secondary" id="btnReset">Xem l·∫°i t·∫•t c·∫£</button>

        <!-- <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
          <input id="nameInput" placeholder="G√µ t√™n ng∆∞·ªùi nh·∫≠n (v√≠ d·ª•: em y√™u)" style="padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);min-width:180px" />
          <button class="btn secondary" id="btnSaveName">L∆∞u t√™n</button>
        </div> -->
      </div>
      
      <div class="meta">
        <div>Thi·∫øt k·∫ø: Embe c·ªßa anh ‚ù§Ô∏è</div>
        <!-- <div id="counter">C√≤n l·∫°i: <span id="leftCount">0</span> l·ªùi.</div> -->
      </div>
    </div>
  </div>

  <script>
    // ====== Messages array (t√πy ch·ªânh ·ªü ƒë√¢y) ======
    const messages = [
      'Ch√∫c em m·ªôt ng√†y tr√†n ng·∫≠p n·ª• c∆∞·ªùi v√† nh·ªØng ƒëi·ªÅu ng·ªçt ng√†o nh·∫•t.',
      'M·ªói kho·∫£nh kh·∫Øc b√™n em l√† m·ªôt b·∫£n t√¨nh ca anh kh√¥ng mu·ªën k·∫øt th√∫c.',
      'Y√™u em kh√¥ng ph·∫£i l√† l·ª±a ch·ªçn, m√† l√† ƒëi·ªÅu anh lu√¥n bi·∫øt ch·∫Øc.',
      'Cu·ªôc s·ªëng n√†y v√¨ em m√† ƒë·∫πp h∆°n r·∫•t nhi·ªÅu. C·∫£m ∆°n em ƒë√£ xu·∫•t hi·ªán.',
      'Mong em lu√¥n kh·ªèe, lu√¥n c∆∞·ªùi v√† lu√¥n b√™n anh.',
      'Em l√† l√Ω do anh tin v√†o ph√©p m√†u m·ªói ng√†y.',
      'D√π con ƒë∆∞·ªùng c√≥ g·∫≠p gh·ªÅnh, anh s·∫Ω lu√¥n n·∫Øm tay em ƒëi ti·∫øp.',
      'M·ªôt c√°i √¥m t·ª´ xa g·ª≠i t·ªõi em ‚Äî ·∫•m √°p, an to√†n v√† tr·ªçn v·∫πn.',
      'Anh th√≠ch em ‚Äî th√≠ch c√°ch em c∆∞·ªùi, th√≠ch c·∫£ nh·ªØng ƒëi·ªÅu nh·ªè b√© c·ªßa em.',
      'Ng√†y h√¥m nay s·∫Ω th·∫≠t ƒë·∫πp, v√¨ c√≥ em trong suy nghƒ© c·ªßa anh.'
    ];

    // Copy and manage unused pool so we don't repeat until all shown
    let pool = [...messages];
    const messageEl = document.getElementById('message');
    const fromEl = document.getElementById('from');
    const leftCountEl = document.getElementById('leftCount');
    const nameInput = document.getElementById('nameInput');

    function updateCounter(){ leftCountEl.textContent = pool.length }
    updateCounter();

    // personalize name
    const savedName = localStorage.getItem('gift_name') || 'Ng∆∞·ªùi t·∫∑ng';
    fromEl.textContent = '‚Äî ' + savedName;
    nameInput.value = localStorage.getItem('gift_name_input') || '';

    document.getElementById('btnSaveName').addEventListener('click', ()=>{
      const v = nameInput.value.trim();
      if(v){ localStorage.setItem('gift_name', v); localStorage.setItem('gift_name_input', v); fromEl.textContent = '‚Äî ' + v; }
      else{ localStorage.removeItem('gift_name'); localStorage.removeItem('gift_name_input'); fromEl.textContent = '‚Äî Ng∆∞·ªùi t·∫∑ng'; }
    });

    document.getElementById('btnRandom').addEventListener('click', ()=>{
      if(pool.length === 0){ // re-seed if empty
        pool = [...messages];
      }
      const idx = Math.floor(Math.random()*pool.length);
      const pick = pool.splice(idx,1)[0];
      showMessage(pick);
      updateCounter();
      launchConfetti();
    });

    document.getElementById('btnReset').addEventListener('click', ()=>{
      pool = [...messages];
      updateCounter();
      showMessage('ƒê√£ ƒë·∫∑t l·∫°i danh s√°ch l·ªùi ch√∫c ‚Äî b·∫•m "Nh·∫≠n l·ªùi ch√∫c" ƒë·ªÉ ti·∫øp t·ª•c!');
    });

    function showMessage(text){
      messageEl.style.opacity = 0;
      setTimeout(()=>{ messageEl.textContent = text; messageEl.style.opacity = 1 }, 220);
    }

    // ====== Floating hearts generator ======
    const heartsContainer = document.getElementById('hearts');
    function spawnHeart(){
      const h = document.createElement('i');
      h.className = 'heart';
      const size = Math.random()*28 + 16; // 16 - 44px
      h.style.width = size+'px'; h.style.height = size+'px';
      h.style.left = Math.random()*100 + '%';
      h.style.animationDuration = (8 + Math.random()*8) + 's';
      h.style.opacity = Math.random()*0.6 + 0.4;
      heartsContainer.appendChild(h);
      setTimeout(()=>{ h.remove() }, 16000);
    }
    // spawn a few at start and then interval
    for(let i=0;i<8;i++) setTimeout(spawnHeart, i*600);
    setInterval(spawnHeart, 1200);

    // ====== Simple confetti on canvas ======
    const canvas = document.getElementById('conf');
    const ctx = canvas.getContext('2d');
    let W = canvas.width = window.innerWidth;
    let H = canvas.height = window.innerHeight;
    window.addEventListener('resize', ()=>{ W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight });

    const particles = [];
    function launchConfetti(){
      const count = 28;
      for(let i=0;i<count;i++){
        particles.push({
          x: Math.random()*W, y: -10 - Math.random()*80,
          vx: (Math.random()-0.5)*6, vy: 2 + Math.random()*5,
          size: 4 + Math.random()*8,
          rot: Math.random()*360,
          life: 60 + Math.floor(Math.random()*60),
          color: `hsl(${Math.floor(Math.random()*360)},70%,60%)`
        });
      }
    }

    function confettiLoop(){
      ctx.clearRect(0,0,W,H);
      for(let i=particles.length-1;i>=0;i--){
        const p = particles[i];
        p.x += p.vx; p.y += p.vy; p.vy += 0.08; p.rot += 6;
        ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot * Math.PI/180);
        ctx.fillStyle = p.color; ctx.fillRect(-p.size/2,-p.size/2,p.size,p.size*1.6);
        ctx.restore();
        p.life--;
        if(p.y > H + 40 || p.life <= 0) particles.splice(i,1);
      }
      requestAnimationFrame(confettiLoop);
    }
    confettiLoop();

    // optional: start with a gentle confetti
    setTimeout(()=>{ launchConfetti() }, 600);

    // accessibility: keyboard: space or enter triggers
    document.addEventListener('keydown',(e)=>{
      if(e.code === 'Space' || e.code === 'Enter'){
        e.preventDefault(); document.getElementById('btnRandom').click();
      }
    });

  </script>
  <!-- Loading Screen -->
  <div id="loading" style="position:fixed;inset:0;background:linear-gradient(135deg,#ffafbd,#ffc3a0);display:flex;align-items:center;justify-content:center;flex-direction:column;z-index:9999;color:white;font-family:'Inter';transition:opacity .6s">
    <div style="font-size:32px;font-weight:700;margin-bottom:20px">Anh ƒë·ª£i ebe 1 x√≠u ·∫°‚Ä¶ üíó</div>
    <div class="loader" style="width:70px;height:70px;border-radius:50%;border:6px solid rgba(255,255,255,0.4);border-top-color:white;animation:spin 1s linear infinite"></div>
  </div>

  <style>
    @keyframes spin {from{transform:rotate(0)} to{transform:rotate(360deg)}}
  </style>

  <script>
    // Loading 10s
    window.addEventListener('load', ()=>{
      setTimeout(()=>{
        const ld = document.getElementById('loading');
        ld.style.opacity = 0;
        setTimeout(()=> ld.remove(), 600);
      }, 10000); // 10s
    });
  </script>

  <!-- Loading for message -->
  <div id="loadingMsg" style="position:fixed;inset:0;background:rgba(0,0,0,0.45);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;flex-direction:column;z-index:9998;color:white;font-family:'Inter';transition:opacity .4s">
    <div style="font-size:26px;font-weight:600;margin-bottom:18px">ƒêang chu·∫©n b·ªã l·ªùi ch√∫c cho anh‚Ä¶ üíó</div>
    <div class="loader2" style="width:55px;height:55px;border-radius:50%;border:6px solid rgba(255,255,255,0.4);border-top-color:white;animation:spin 1s linear infinite"></div>
  </div>

  <script>
    const loadingMsg = document.getElementById('loadingMsg');
    const originalShowMessage = showMessage;

    // Override random button behavior with loading 10s
    document.getElementById('btnRandom').addEventListener('click', async (e)=>{
      e.stopImmediatePropagation(); // prevent double firing
      loadingMsg.style.display = 'flex';
      loadingMsg.style.opacity = 1;

      await new Promise(r => setTimeout(r, 1)); // 10s loading

      loadingMsg.style.opacity = 0;
      setTimeout(()=> loadingMsg.style.display = 'none', 500);

      // execute original logic
      if(pool.length === 0) pool = [...messages];
      const idx = Math.floor(Math.random()*pool.length);
      const pick = pool.splice(idx,1)[0];
      originalShowMessage(pick);
      updateCounter();
      launchConfetti();
    }, true);
  </script>

</body>
</html>
